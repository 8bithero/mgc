$(function(){function t(e){var t="; "+document.cookie,n=t.split("; "+e+"=");if(n.length==2)return n.pop().split(";").shift()}function r(e){var t=$("#post-status"),n=t.text();if(n!=e){if(e=="publish"){TweenMax.to(t,.4,{alpha:0});t.removeClass("bg-warning");t.text(e);t.addClass("bg-primary");TweenMax.to(t,.4,{delay:2,alpha:1});localStorage.setItem("post-status","publish")}else if(e=="draft"){TweenMax.to(t,.4,{alpha:0});t.removeClass("bg-primary");t.text(e);t.addClass("bg-warning");TweenMax.to(t,.4,{delay:2,alpha:1});localStorage.setItem("post-status","draft")}return}}function i(e){var t=e.getFullYear(),n=s(e.getMonth()),r=s(e.getDay()),i=r+"/"+n+"/"+t;$("#post_date").html(i)}function s(e){return e<10?"0"+e:""+e}function o(){var t=$("#project-id").val(),n=$.ajax({type:"POST",url:e+"/wp-admin/admin-ajax.php",data:{action:"remove_thumbnail",delete_id:t},beforeSend:function(e){u||$(".ajax-modal").addClass("md-show")},success:function(e){console.log(e)},error:function(e){console.log("Ajax Error")}});$.when(n).then(function(){$("#thumb").hide(150);$("#dragdrop").show(150);$(".ajax-modal").removeClass("md-show")})}function a(t){var n=$("#project-id").val(),r=$("#project-title").val(),i=$("#select2-categories").val(),s=$("#project-video").val(),o=$("#project-content").val(),u=$("#project-status").val();if(!t){event.preventDefault();var u="publish"}var a=$.ajax({type:"POST",url:e+"/wp-admin/admin-ajax.php",data:{action:"project_submit",status:u,id:n,title:r,content:o,categories:i,video:s,autosave:t},beforeSend:function(e){t||$(".ajax-modal").addClass("md-show")},success:function(e){var n=JSON.parse(e),r=new Date,i=r.getHours(),s=r.getMinutes(),o=r.getSeconds(),u="at "+i+":"+s;t?$("#post_time").html("Autosave "+u):$("#post_time").text("Submitted")},error:function(e){console.log("Ajax Error")}});$.when(a).then(function(){$(".ajax-modal").removeClass("md-show")})}function c(){var e=setInterval(function(e){u=!0;a(u)},5e4)}var e=localStorage.getItem("blog-url"),n=t("post_id");if($.fn.select2){$("#select2-option").select2();$("#select2-tags").select2({tags:["Explainer video","Animation","Commercial","Music video","Program titles","Short film","Showreel"],tokenSeparators:[","," "]});$("#select2-categories").select2()}$(".project-editor").mouseleave(function(){var e=$(this).html();$("#project-content").html(e)});$(".video_source").on("click",function(){event.preventDefault();var e=$(this).data("source");$(".input-video").html($(this).text()+' <span class="caret"></span>');e=="vimeo"?$("input.video-input").val("http://vimeo.com/"):e=="youtube"&&$("input.video-input").val("http://www.youtube.com/watch?v=")});i(new Date);var u=!1,f=!1;$("#publish_project").click(function(e){a();f=!0;$("#project-status").val("publish");r("publish")});$("#draft_project").click(function(e){a(u);r("draft")});$("#remove-thumb").click(function(e){o();a(u)});var l;c();$("#formpost-project input").change(function(){clearInterval(l);u=!0;a(u)});$(".project-editor").focusout(function(){clearInterval(l);u=!0;a(u)});pconfig=JSON.parse(JSON.stringify(base_plupload_config));pconfig.multipart_params.id=localStorage.getItem("post-id");console.log(pconfig);var h=new plupload.Uploader(pconfig);h.bind("Init",function(e){var t=$("#plupload-upload-ui");if(e.features.dragdrop){t.addClass("drag-drop");$("#drag-drop-area").bind("dragover.wp-uploader",function(){t.addClass("drag-over")}).bind("dragleave.wp-uploader, drop.wp-uploader",function(){t.removeClass("drag-over")})}else{t.removeClass("drag-drop");$("#drag-drop-area").unbind(".wp-uploader")}});h.init();h.bind("FilesAdded",function(e,t){var n=104857600,r=parseInt(e.settings.max_file_size,10);plupload.each(t,function(t){r>n&&t.size>n&&e.runtime!="html5"?alert("error"):console.log(t)});e.refresh();e.start()});h.bind("FileUploaded",function(e,t,n){console.log(n);alert("done")})});